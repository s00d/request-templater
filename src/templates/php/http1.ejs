<% const { url, method, mimeType, headers, postData, cookies } = locals; %>
<?php

    $host = parse_url("<%= url %>", PHP_URL_HOST);
    $path = parse_url("<%= url %>", PHP_URL_PATH) ?: "/";

    $httpHeaders = array(
    <% headers.forEach(header => { %>
        "<%= header.name %>: <%= header.value %>",
    <% }) %>
    );

    $httpCookies = array(
    <% cookies.forEach(cookie => { %>
        "<%= cookie.name %>" => "<%= cookie.value %>",
    <% }) %>
    );

    $httpBody = null;
    if ("<%= method %>" === "POST") {
        $httpBody = "<%= postData.map(param => param.name + '=' + urlencode(param.value)).join('&') %>";
    }

    $request = new http\Client\Request("<%= method %>", "http://$host$path");
    $request->setHeaders($httpHeaders);
    $request->setCookies($httpCookies);
    $request->setBody($httpBody);

    $client = new http\Client;
    $client->enqueue($request);

    $response = $client->send();

    echo "Response: " . $response->getBody();

?>
